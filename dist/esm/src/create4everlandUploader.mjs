import{regeneratorRuntime as e}from"../_virtual/_rollupPluginBabelHelpers.mjs";import{__awaiter as n}from"../node_modules/tslib/tslib.es6.mjs";import{S3Client as t}from"../node_modules/@aws-sdk/client-s3/dist-es/S3Client.mjs";import{createGenericFileFromJson as r}from"../node_modules/@metaplex-foundation/umi/dist/esm/GenericFile.mjs";import{lamports as o}from"../node_modules/@metaplex-foundation/umi/dist/esm/Amount.mjs";import{HeadObjectCommand as s}from"../node_modules/@aws-sdk/client-s3/dist-es/commands/HeadObjectCommand.mjs";import{PutObjectCommand as u}from"../node_modules/@aws-sdk/client-s3/dist-es/commands/PutObjectCommand.mjs";function a(a,i){var d=this,m=new t({endpoint:"https://endpoint.4everland.co",credentials:a,region:"eu-west-2"}),c=function(t){return n(d,void 0,void 0,e().mark((function n(){var r,o,a,d,c,p,f;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new u({Bucket:i,Key:t.uniqueName,Body:t.buffer,ContentType:t.contentType||void 0}),e.next=3,m.send(r);case 3:return o=e.sent,a=new s({Bucket:i,Key:t.uniqueName}),e.next=7,m.send(a);case 7:if(d=e.sent,c=d.Metadata,!(p=c["arweave-hash"])){e.next=12;break}return e.abrupt("return",p);case 12:return f="",o.ETag&&(f=JSON.parse(o.ETag)),e.abrupt("return",f);case 15:case"end":return e.stop()}}),n)})))},p=function(t){return n(d,void 0,void 0,e().mark((function n(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return c(e)}))));case 1:case"end":return e.stop()}}),n)})))};return{upload:p,uploadJson:function(t){return n(d,void 0,void 0,e().mark((function n(){var o,s;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r(t),e.next=3,p([o]);case 3:return s=e.sent,e.abrupt("return",s[0]);case 5:case"end":return e.stop()}}),n)})))},getUploadPrice:function(){return n(d,void 0,void 0,e().mark((function n(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(0));case 1:case"end":return e.stop()}}),n)})))}}}export{a as create4everlandUploader};
